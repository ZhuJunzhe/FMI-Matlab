%
%FMI - Chapter 1 - Fig xx
%


function GE = GEtest()
%compare SGE channel and i.i.d. channel


%packet num
pktnum = 100;
%average packet error rate
pe = 0.10;

%
x=0:pktnum;

for i=1:pktnum+1
    %i.i.d
    y1(1,i) = cnmper(pktnum,i-1,pe);
    if y1(1,i) < 1e-10
        y1(1,i) = 0.0;
    end
    %SGE, correlation 0
%     y2(1,i) = PLRcal(i,pktnum,pe,0);
%     %SGE, correlation 0.10
%     y3(1,i) = PLRcal(i,pktnum,pe,0.10);
%     %SGE, correlation 0.50
%     y4(1,i) = PLRcal(i,pktnum,pe,0.50);
end

%SGE, correlation 0
y2 = [
0.0000265614
0.0002951267
0.0016231966
0.0058916025
0.0158745955
0.0338658038
0.0595787289
0.0888952464
0.1148230266
0.1304162771
0.1318653468
0.1198775880
0.0987880124
0.0743020948
0.0513038273
0.0326824382
0.0192917170
0.0105915309
0.0054265251
0.0026021933
0.0011709870
0.0004956559
0.0001977617
0.0000745189
0.0000265646
0.0000089729
0.0000028759
0.0000008758
0.0000002537
0.0000000700
0.0000000184
0.0000000046
0.0000000011
0.0000000003
0.0000000001
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
];

%SGE, correlation 0.10
y3 = [
0.0000793123
0.0006999324
0.0031412449
0.0095481429
0.0220906092
0.0414555734
0.0656738281
0.0902646660
0.1097959470
0.1199861840
0.1191957044
0.1086598457
0.0916021501
0.0718712199
0.0527672757
0.0364197434
0.0237244686
0.0146366685
0.0085780019
0.0047883325
0.0025518863
0.0013011572
0.0006359254
0.0002984172
0.0001346615
0.0000585144
0.0000245145
0.0000099133
0.0000038734
0.0000014637
0.0000005354
0.0000001897
0.0000000652
0.0000000217
0.0000000070
0.0000000022
0.0000000007
0.0000000002
0.0000000001
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
];

%SGE, correlation 0.50
y4 = [
0.0056089224
0.0142942067
0.0258696219
0.0388873062
0.0517778298
0.0631182155
0.0718493069
0.0773717889
0.0795391673
0.0785803746
0.0749868482
0.0693933953
0.0624731502
0.0548575934
0.0470848386
0.0395739874
0.0326203284
0.0264050754
0.0210136204
0.0164573230
0.0126952146
0.0096533217
0.0072404423
0.0053600454
0.0039185250
0.0028303435
0.0020207313
0.0014266022
0.0009962714
0.0006884524
0.0004708902
0.0003188828
0.0002138523
0.0001420575
0.0000934908
0.0000609688
0.0000394051
0.0000252446
0.0000160329
0.0000100958
0.0000063037
0.0000039032
0.0000023970
0.0000014600
0.0000008820
0.0000005286
0.0000003142
0.0000001853
0.0000001084
0.0000000629
0.0000000362
0.0000000207
0.0000000117
0.0000000066
0.0000000037
0.0000000020
0.0000000011
0.0000000006
0.0000000003
0.0000000002
0.0000000001
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
0.0000000000
];

%normal plot
%h = plot(x,y1,'g-',x,y2,'b--',x,y3,'k-.',x,y4,'m:','LineWidth',1);

%log y
h = semilogy(x,y1,'g-',x,y2,'b--',x,y3,'k-.',x,y4,'m:','LineWidth',1);

%log x
%h = semilogx(x,y1,'g-',x,y2,'b--',x,y3,'k-.',x,y4,'m:','LineWidth',1);

%log x, log y
%h = loglog(x,y1,'g-',x,y2,'b--',x,y3,'k-.',x,y4,'m:','LineWidth',1);

%set x limit
set(gca,'XLim',[0 pktnum]);
%set(gca,'YLim',[1e-10 0.5]);


%set x scale for log x!!!
%set(gca,'XMinorTick','off');
%set(gca,'XTick',[0 20 40 60 80 pktnum]);

%set y scale for log y!!!
%set(gca,'YMinorTick','off');
%set(gca,'YTick',[1e-10 1e-8 1e-6 1e-4 1e-2 0.1 0.2]);


grid on

xlabel('Number of packet loss in a sequence of 100 packets','FontSize',12)
ylabel('Probability','FontSize',12)
legend('i.i.d. channel','SGE channel, correlation 0.00','SGE channel, correlation 0.10','SGE channel, correlation 0.50')



%
function PLR = PLRcal(k,n,pe,corr)
%probability that k errors in n transmissions
    a = pe + corr*(1-pe);
    b = (1-pe) + corr*pe;
    PLR = PLRGcal(k,n,a,b) + PLRBcal(k,n,a,b);

function PLRG = PLRGcal(k,n,a,b)
%probability that k errors in n transmissions ending in state Good
    if (k==0 && n==0)
        PLRG = (1-a)/(2-a-b);
    else if (n==0)
            PLRG = 0;
        else
            PLRG = PLRGcal(k,n-1,a,b)*b + PLRBcal(k,n-1,a,b)*(1-a);
        end
    end

function PLRB = PLRBcal(k,n,a,b)
%probability that k errors in n transmissions ending in state Bad
    if (k==0 && n==0)
        PLRB = (1-b)/(2-a-b);
    else if (n==0)
            PLRB = 0;
        else
            PLRB = PLRBcal(k-1,n-1,a,b)*a + PLRGcal(k-1,n-1,a,b)*(1-b);
        end
    end

function cnmp = cnmper(n,m,per)
%calculate cnm(n,m)*per^m*(1-per)^(n-m)
    sum = 1.0;
    for i=1:m
        sum = sum*per*(n-i+1)/(m-i+1);
    end
    sum = sum*((1-per)^(n-m));
    cnmp = sum;

function cnm = cnmcal(n,m)
%get m of n, n!/(m!(n-m)!)
    sum = 1;
    for i=1:m
        sum = sum*(n-i+1)/(m-i+1);
    end
    cnm = sum;


function fact = fact(m)
%compute fact
    sum = 1;
    for i=1:m
        sum = sum*i;
    end
    if m == 0
        sum = 1;
    end
    fact = sum;